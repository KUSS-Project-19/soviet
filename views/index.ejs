<!doctype html>
<html>
  <head>
    <meta charset='utf-8'>
    <title>Internet of Soviets</title>
    <script>
      function deviceAction(dvid) {
        var http = new XMLHttpRequest()
        http.onreadystatechange = function() {
          location.reload(1)
        }
        http.open('post', '/do_action')
        http.setRequestHeader('Content-Type', 'application/json;charset=UTF-8')
        http.send(JSON.stringify({ dvid: dvid }))
      }

      setTimeout(function() {
        location.reload(1)
      }, 5000)
    </script>
  </head>
  <body>
    <div>
      Greetings, <%= urname %>!
      <a href='/signout'>Sign Out</a>
    </div>
    <div>
      <a href='/register'>Register a device</a>
    </div>
    <div>
      <table>
        <caption>Your Devices</caption>
        <thead>
          <tr>
            <td>ID</td>
            <td>Name</td>
            <td>Online</td>
            <td>Sensor</td>
            <td>Time</td>
            <td>Action</td>
          </tr>
        </thead>
        <tbody>
          <% for (var i = 0; i < devices.length; ++i) { %>
          <tr>
            <td>#<%= devices[i].dvid %></td>
            <td>"<%= devices[i].dvname %>"</td>
            <td><%= devices[i].isOnline ? 'O' : 'X' %></td>
            <td><%= devices[i].sensor %></td>
            <td><%= devices[i].sensorUpdated %></td>
            <td><input type='submit' value='Do something'
              onclick='deviceAction(<%= devices[i].dvid %>)'></td>
          </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </body>
</html>
